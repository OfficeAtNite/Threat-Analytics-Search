(()=>{"use strict";var e,r={260:(e,r,t)=>{t(802),t(372);var n=t(486),i=t.n(n);const a={CARBON_BLACK:"carbon_black",LAST_CONFIG_DATA:"last_config_data",NET_WITNESS:"netwitness_investigator",RSA_SECURITY:"rsa_security_analytics",SEARCH_PROVIDERS:"search_providers",SETTINGS:"settings"};var o=t(826),s=t.n(o),c=t(568),u=t.n(c);function l(e,r){const t=(e=Array.from(atob(e),(e=>e.charCodeAt(0)))).slice(8,16),n=function(e,r){const t=e.concat(r);let n=[],i=[];n[0]=s().utils.hex.toBytes(u()(t)),i=n[0];for(let e=1;e<3;e++)n[e]=s().utils.hex.toBytes(u()(n[e-1].concat(t))),i=i.concat(n[e]);return{key:i.slice(0,32),iv:i.slice(32,48)}}(Array.from(unescape(encodeURIComponent(r)),(e=>e.charCodeAt(0))),t);e=e.slice(16,e.length);const i=new(s().ModeOfOperation.cbc)(n.key,n.iv).decrypt(e);return s().utils.utf8.fromBytes(s().padding.pkcs7.strip(i))}var p=t(168);const g=[{index:0,field:"configurationURL"},{index:1,field:"useGroups",type:"bool"},{index:2,field:"configEncrypted",type:"bool"},{index:3,field:"configEncryptionKey"},{index:4,field:"autoUpdateConfig",type:"bool"}],f=[{index:0,field:"menuIndex"},{index:1,field:"label"},{index:2,field:"query"},{index:3,field:"enabled",type:"bool"}],d=[{index:0,field:"menuIndex"},{index:1,field:"label"},{index:2,field:"link"},{index:3,field:"enabled",type:"bool"},{index:4,field:"fromConfig",type:"bool"},{index:5,field:"group"},{index:6,field:"postEnabled",type:"bool"},{index:7,field:"postValue"},{index:8,field:"proxyEnabled",type:"bool"},{index:9,field:"proxyUrl"}];function m(e,r){return i().mapValues(i().keyBy(r,"field"),(r=>{const t=i().get(e,r.index);return"bool"===r.type?!0===t||"true"===t:t}))}function y(e,r){return i().map(r,(r=>i().get(e,r.field)))}const S={updateNow:async function(){const e=await p.Z.getOne(a.SETTINGS)||{};let r=null;const t=!function(e){try{const r=new URL(e);return["http:","https:"].includes(r.protocol)}catch(e){return!1}}(e.configurationURL),n=e.configEncrypted&&!e.configEncryptionKey;if(t||n)r="Update failed - Invalid "+(n?"Encryption Key":"URL");else try{const t=await fetch(e.configurationURL);if(t.status>=200&&t.status<300){let n=await t.text();if(n=n.replace(/\n\r|\r\n/g,""),e.configEncrypted){var i=e.configEncryptionKey;try{n=l(n,i)}catch(e){console.error(e),r="Update failed - Decryption Error"}}const a=JSON.parse(n);await S.parseJSONFile(a,!1)}else r="Update failed - Invalid URL"}catch(e){console.error(e),r="Update failed - Invalid File"}return await p.Z.setOne(a.LAST_CONFIG_DATA,{date:(new Date).getTime(),errorMsg:r}),!r},updateSpecialProvider:async function(e,r,t,n){const o=await p.Z.getOne(a.SETTINGS),s=n||i().get(o,t+".config",!1),c=n?"override":i().get(o,t+".queries","merge"),u=await p.Z.getOne(e)||{};(s||i().isNil(u.config))&&(u.config=i().get(r,"Config",{}));const l=S.parseQueries(i().get(r,"Queries",[]));if("merge"===c){i().isArray(u.queries)||(u.queries=[]);for(let e=0;e<l.length;e++){const r=l[e],t=i().get(r,"metadata.alias");i().isArray(t)&&i().each(u.queries,(e=>{t.indexOf(e.query)>=0&&(e.query=r.query)})),i().find(u.queries,(e=>e.query===r.query))||u.queries.push(r)}}else"override"===c&&(u.queries=l);return p.Z.setOne(e,u)},sanitizeSettings:async function(){var e=await S.getDefaultJSON(),r=await p.Z.getOne(a.SETTINGS),t=S.parseBasicSettings(e.config);t.providersGroups=S.parseGroups(e.groups),i().isObject(r)&&!i().isArray(r.providersGroups)&&delete r.providersGroups,await p.Z.setOne(a.SETTINGS,i().assign(t,r));var n=await p.Z.getOne(a.SEARCH_PROVIDERS);i().isEmpty(n)&&await p.Z.setOne(a.SEARCH_PROVIDERS,S.parseProviders(e.searchproviders)),await S.sanitizeSpecialProviders()},sanitizeSpecialProviders:async function(){var e=await S.getDefaultJSON(),r=[{storeKey:a.CARBON_BLACK,fileKey:"CBC"},{storeKey:a.NET_WITNESS,fileKey:"NWI"},{storeKey:a.RSA_SECURITY,fileKey:"RSA"}];i().forEach(r,(async function(r){var t=await p.Z.getOne(r.storeKey)||{};i().isObject(t.config)||(t.config=i().get(e,`${r.fileKey}.Config`)||{}),i().isArray(t.queries)||(t.queries=S.parseQueries(i().get(e,`${r.fileKey}.Queries`))),p.Z.setOne(r.storeKey,t)}))},parseJSONFile:async function(e,r){const t=await p.Z.getOne(a.SETTINGS)||{};r&&!i().isEmpty(e.config)&&i().assign(t,S.parseBasicSettings(e.config));const n=e.groups;if((r||t.mergeGroups)&&!i().isEmpty(n))if(r&&n.length>=3||i().isEmpty(t.providersGroups))t.providersGroups=S.parseGroups(n);else for(let e=0;e<t.providersGroups.length;e++)n[e]?t.providersGroups[e].name=n[e][1]:e<3?t.providersGroups[e].enabled=!1:t.providersGroups.splice(3,t.providersGroups.length-3);await p.Z.setOne(a.SETTINGS,t);const o=S.parseProviders(e.searchproviders);await async function(e,r,t,n){let o=await p.Z.getOne(a.SEARCH_PROVIDERS)||[];i().each(t,(e=>{i().each(o,(r=>{e.target.indexOf(r.link)>=0&&(e.link&&(r.link=e.link),e.label&&(r.label=e.label))}))}));const s=n?"override":i().get(e,"mergeSearchProviders","merge");if("override"===s)o=r;else if("merge"===s)for(let e=0;e<r.length;e++){const t=r[e];i().find(o,(e=>e.link===t.link))||o.push(t)}await p.Z.setOne(a.SEARCH_PROVIDERS,o)}(t,o,i().get(e,"update.providers"),r),await S.updateSpecialProvider(a.RSA_SECURITY,e.RSA,"mergeRSA",r),await S.updateSpecialProvider(a.NET_WITNESS,e.NWI,"mergeNWI",r),await S.updateSpecialProvider(a.CARBON_BLACK,e.CBC,"mergeCBC",r)},parseBasicSettings:function(e){const r=m(i().get(e,0,[]),g);return{...r,resultsInBackgroundTab:!0,enableAdjacentTabs:!0,openGroupsInNewWindow:!0,enableOptionsMenuItem:!0,mergeGroups:r.useGroups,mergeSearchProviders:"merge",mergeCBC:{config:!1,queries:"merge"},mergeNWI:{config:!1,queries:"merge"},mergeRSA:{config:!1,queries:"merge"}}},prepareBasicSettings:function(e){return[y(e,g)]},parseGroups:function(e){return i().isArray(e)&&e.length>=3?i().map(e,(function(e,r){return{name:i().get(e,1),enabled:r<2}})):[]},prepareGroups:function(e){return i().map([0,1,2],(function(r){return[r+1+"",i().get(e,`${r}.name`)]}))},parseProviders:function(e){return i().map(e,(function(e){return m(e,d)}))},prepareProviders:function(e){return i().map(e,(function(e){return y(e,d)}))},parseQueries:function(e){return i().map(e,(function(e){return m(e,f)}))},prepareQueries:function(e){return i().map(e,(function(e){return y(e,f)}))},getDefaultJSON:async function(){try{var e=await fetch("../settings.json");return await e.json()}catch(e){return{}}},generateJSONFile:async function(){var e=await p.Z.getOne(a.SETTINGS)||{},r=await p.Z.getOne(a.RSA_SECURITY)||{},t=await p.Z.getOne(a.NET_WITNESS)||{},n=await p.Z.getOne(a.CARBON_BLACK)||{},i=await p.Z.getOne(a.SEARCH_PROVIDERS)||[];return{searchproviders:S.prepareProviders(i),groups:S.prepareGroups(e.providersGroups),config:S.prepareBasicSettings(e),RSA:{Config:r.config,Queries:S.prepareQueries(r.queries)},NWI:{Config:t.config,Queries:S.prepareQueries(t.queries)},CBC:{Config:n.config,Queries:S.prepareQueries(n.queries)}}}},v=S,I={setItem:function(e,r){try{window.localStorage.removeItem(e),window.localStorage.setItem(e,r)}catch(e){console.error(e)}},getItem:function(e){var r;try{r=window.localStorage.getItem(e)}catch(e){console.error(e),r="null"}return r},clearAll:function(){window.localStorage.clear()}};var w=["http://www.criticalstart.com/cschromeplugin/criticalstart.txt","https://www.criticalstart.com/wp-content/uploads/2018/02/criticalstart.txt"];function O(e){const r=v.parseBasicSettings(e.config),t=v.parseGroups(e.groups);let n=I.getItem("_configUrl");(i().isEmpty(n)||w.indexOf(n)>=0)&&(n=r.configurationURL);const o="true"===I.getItem("_configUseGroups")||i().get(r,"useGroups",!1);return p.Z.setOne(a.SETTINGS,{configurationURL:n,useGroups:o,configEncrypted:"true"===I.getItem("_configEnc"),configEncryptionKey:I.getItem("_configEncKey")||null,autoUpdateConfig:"true"===I.getItem("_configAutoRefresh")||i().get(r,"autoUpdateConfig",!1),providersGroups:[{name:I.getItem("_group1Name")||i().get(t,"0.name"),enabled:!0},{name:I.getItem("_group2Name")||i().get(t,"1.name"),enabled:!0},{name:I.getItem("_group3Name")||i().get(t,"2.name"),enabled:"true"==I.getItem("_enableGroup3")}],resultsInBackgroundTab:"false"!==I.getItem("_askbg"),enableAdjacentTabs:"false"!==I.getItem("_asknext"),openGroupsInNewWindow:"false"!==I.getItem("_asknewwindow"),enableOptionsMenuItem:"false"!==I.getItem("_askoptions"),mergeGroups:o,mergeSearchProviders:"merge",mergeCBC:{config:!1,queries:"merge"},mergeNWI:{config:!1,queries:"merge"},mergeRSA:{config:!1,queries:"merge"}})}function h(e){return p.Z.setOne(a.SEARCH_PROVIDERS,v.parseProviders(E(I.getItem("_allsearch"))||i().get(e,"searchproviders",[])))}function C(e,r,t,n,a){return p.Z.setOne(e,{config:E(I.getItem(t))||i().get(a,`${r}.Config`,{}),queries:v.parseQueries(E(I.getItem(n))||i().get(a,`${r}.Queries`,[]))})}function _(e){let r,t;return!i().isNil(e)&&function(e){return"Invalid Date"!==new Date(e)&&!isNaN(new Date(e))}(e)?t=new Date(e).getTime():r=e,{date:t,errorMsg:r}}function E(e){var r;try{r=JSON.parse(e)}catch(e){r=null}return r}document.addEventListener("DOMContentLoaded",(async function(){const e=await v.getDefaultJSON();await Promise.all([O(e),h(e),C(a.CARBON_BLACK,"CBC","_CBCConfig","_CBCallquery",e),C(a.NET_WITNESS,"NWI","_NWIConfig","_NWIallquery",e),C(a.RSA_SECURITY,"RSA","_RSAConfig","_RSAallquery",e),p.Z.setOne(a.LAST_CONFIG_DATA,_(I.getItem("_configLastRefresh")))]),chrome.runtime.sendMessage({action:"updateContextualMenu"}),chrome.tabs.getCurrent((function(e){chrome.tabs.remove(e.id)}))}))}},t={};function n(e){var i=t[e];if(void 0!==i)return i.exports;var a=t[e]={id:e,loaded:!1,exports:{}};return r[e].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.m=r,e=[],n.O=(r,t,i,a)=>{if(!t){var o=1/0;for(l=0;l<e.length;l++){for(var[t,i,a]=e[l],s=!0,c=0;c<t.length;c++)(!1&a||o>=a)&&Object.keys(n.O).every((e=>n.O[e](t[c])))?t.splice(c--,1):(s=!1,a<o&&(o=a));if(s){e.splice(l--,1);var u=i();void 0!==u&&(r=u)}}return r}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[t,i,a]},n.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return n.d(r,{a:r}),r},n.d=(e,r)=>{for(var t in r)n.o(r,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="./",(()=>{var e={440:0};n.O.j=r=>0===e[r];var r=(r,t)=>{var i,a,[o,s,c]=t,u=0;if(o.some((r=>0!==e[r]))){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(c)var l=c(n)}for(r&&r(t);u<o.length;u++)a=o[u],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(l)},t=self.webpackChunkthreat_analytics_search=self.webpackChunkthreat_analytics_search||[];t.forEach(r.bind(null,0)),t.push=r.bind(null,t.push.bind(t))})(),n.nc=void 0;var i=n.O(void 0,[654,242,456],(()=>n(260)));i=n.O(i)})();
//# sourceMappingURL=migration.js.map